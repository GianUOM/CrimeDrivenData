import csv
import re
import spacy

nlp = spacy.load("en_core_web_sm")
# Function to extract entities related to crime, location, and date
def extract_entities(text):
    entities = {
        "Crime": [],
        "Location": [],
        "Date": [],
        "Names": []
    }
    doc = nlp(text)

    for ent in doc.ents:
        if ent.label_ == "DATE":
            entities["Date"].append(ent.text)
        elif ent.label_ == "PERSON" and ent.text.lower() not in ["qormi"] and ent.text.lower() not in ["mater dei"] and ent.text.lower() not in ["bitcoin"] and ent.text.lower() not in ["marsaxlokk"] and ent.text.lower() not in ["wuppertaler rundschau"] and ent.text.lower() not in ["macbook pro"] and ent.text.lower() not in ["bild"] and ent.text.lower() not in ["witnesses"] and ent.text.lower() not in ["triq lampuka"] and ent.text.lower() not in ["episode"] and ent.text.lower() not in ["mizan online"] and ent.text.lower() not in ["mosta"] and ent.text.lower() not in ["st francis square"] and ent.text.lower() not in ["messenger"] and ent.text.lower() not in ["gew kobba"] and ent.text.lower() not in ["guilty"] and ent.text.lower() not in ["st paul’s bay"] and ent.text.lower() not in ["gudja"] and ent.text.lower() not in ["facebook messenger"] and ent.text.lower() not in ["papaya"] and ent.text.lower() not in ["stratton"] and ent.text.lower() not in ["moretti"] and ent.text.lower() not in ["children"] and ent.text.lower() not in ["twitter"] and ent.text.lower() not in ["related stories  "] and ent.text.lower() not in ["st julian's"] and ent.text.lower() not in ["valletta"] and ent.text.lower() not in ["sta venera"] and ent.text.lower() not in ["triq bajjada"] and ent.text.lower() not in ["marsa"] and ent.text.lower() not in ["ġħajn żnuber"] and ent.text.lower() not in ["reliable"] and ent.text.lower() not in ["rabat"] and ent.text.lower() not in ["domestic abuse"] and ent.text.lower() not in ["voluntary"] and ent.text.lower() not in ["triq garibaldi"] and ent.text.lower() not in ["birkirkara"] and ent.text.lower() not in ["mrieħel"] and ent.text.lower() not in ["ħamrun"] and ent.text.lower() not in ["triq"] and ent.text.lower() not in ["żejtun"] and ent.text.lower() not in ["recruiter"] and ent.text.lower() not in ["teen"] and ent.text.lower() not in ["mġarr"] and ent.text.lower() not in ["st mary’s college"] and ent.text.lower() not in ["għar lapsi"] and ent.text.lower() not in ["mediatrix place"] and ent.text.lower() not in ["gżira"] and ent.text.lower() not in ["mediapart"] and ent.text.lower() not in ["mqabba"] and ent.text.lower() not in ["lengthy"] and ent.text.lower() not in ["aġenzija appoġġ"] and ent.text.lower() not in ["apart"] and ent.text.lower() not in ["marijuana"] and ent.text.lower() not in ["recruitgiant"] and ent.text.lower() not in ["victim"] and ent.text.lower() not in ["van driver"] and ent.text.lower() not in ["smart"] and ent.text.lower() not in ["justifiable homicide"] and ent.text.lower() not in ["journal"] and ent.text.lower() not in ["uber"] and ent.text.lower() not in ["dumbstruck"] and ent.text.lower() not in ["supportline"] and ent.text.lower() not in ["st paul's"] and ent.text.lower() not in ["proud"] and ent.text.lower() not in ["barman"] and ent.text.lower() not in ["aġenzija sapport"] and ent.text.lower() not in ["related stories"] and ent.text.lower() not in ["daughter hostage"] and ent.text.lower() not in ["marsascala"] and ent.text.lower() not in ["gianpula"] and ent.text.lower() not in ["warning"] and ent.text.lower() not in ["tarxien"] and ent.text.lower() not in ["binance"] and ent.text.lower() not in ["paceville"] and ent.text.lower() not in ["banks"] and ent.text.lower() not in ["whatsapp"] and ent.text.lower() not in ["swieqi"] and ent.text.lower() not in ["lazio"] and ent.text.lower() not in ["lecce"] and ent.text.lower() not in ["torvaianica"] and ent.text.lower() not in ["scampia"] and ent.text.lower() not in ["balocco"] and ent.text.lower() not in ["dior"] and ent.text.lower() not in ["lobby"] and ent.text.lower() not in ["graffiti"] and ent.text.lower() not in ["st paul the hermit"] and ent.text.lower() not in ["graffiti tags"] and ent.text.lower() not in ["wied"] and ent.text.lower() not in ["tbs crew"] and ent.text.lower() not in ["st paul's bay"] and ent.text.lower() not in ["revolutionary guards"] and ent.text.lower() not in ["blade runner"] and ent.text.lower() not in ["a st paul's bay"] and ent.text.lower() not in ["tiktoker"] and ent.text.lower() not in ["efforts"] and ent.text.lower() not in ["st julians"] and ent.text.lower() not in ["godfather"] and ent.text.lower() not in ["triq il-mater boni consilii"] and ent.text.lower() not in ["lovin malta"] and ent.text.lower() not in ["st julian’s"] and ent.text.lower() not in ["krispy kreme"] and ent.text.lower() not in ["covid"] and ent.text.lower() not in ["youths"] and ent.text.lower() not in ["a st paul’s bay"] and ent.text.lower() not in ["triq sant' antnin"] and ent.text.lower() not in ["st francis street"] and ent.text.lower() not in ["st luke’s hospital"] and ent.text.lower() not in ["failures"] and ent.text.lower() not in ["newsbook"] and ent.text.lower() not in ["għajn żnuber"]:
            entities["Names"].append(ent.text)
    
    # Crime extraction
    crime_keywords = ["money-laundering", "sanctions", "fraud", "anti-money laundering", "malware", "FBI", "cybercriminals", "constitutional case", "fraud charges", "drugs", "scams", "attacked", "knife", "stabbing", "murder", "attempted murder", "sex crimes", "rape", "shooting", "assault", "plea bargain", "gunshot", "gang attack", "robing", "cocaine", "heroin", "cannabis", "possession", "apartheid", "Mafia", "ganged up", "thief", "armed thief", "breach", "killing", "mafia", "hate speech", "thieves", "stealing", "theft", "organised crime", "operation", "scam", "corruption", "burn", "conspiring", "sexually harassed", "money laundering", "trafficker", "abusing", "sexually abusing", "thefts", "snatch-and-grab", "stabbed", "raped", "killed", "child sex crimes", "threatning", "attack", "suicide", "suicide bombing", "hitting", "with a car", "attacks", "vandalised", "alleged inaction", "fined", "unfair commercial practices","drug trafficking", "nabbed", "drugs dealing", "nabbed", "conning", "sexual assault", "punched", "punching", "indecently touching", "touching", "beat", "hit", "hostage", "hostage-taker", "kill", "murders", "fight", "destroy", "beating", "strikes", "war crimes", "war crime", "film", "filmed", "filming", "sex", "sex video", "mental health", "dine-and-dash", "steals", "dine and dash", "sexually moslesting", "illegaly", "groped", "groping", "grope", "escape", "attempted escape", "domestic violence", "homicide", "involuntary homicide", "illegal recruiment agency", "allegations", "defrauded", "cyberbullying", "art trafficking", "abuse", "document forgery", "trafficking", "staging", "death", "starvation", "burning", "burned", "setting", "fire", "robbed", "gangs", "acid", "shoot"]
    for keyword in crime_keywords:
        if re.search(r'\b' + re.escape(keyword) + r'\b', text, re.IGNORECASE):
            entities["Crime"].append(keyword)
    
    # Location extraction (simplified for demonstration)
    locations = ["Attard", "Balzan", "Il-Bidnija", "Birgu", "Birkirkara", "Mrieħel", "Birżebbuġa", "Bormla", "Dingli", "Fgura", "Furjana", "Għargħur", "Għaxaq", "Gudja", "Gżira", "Ħamrun", "Iklin", "Kalkara", "Kirkop", "Lija", "Luqa", "Marsa", "Marsaskala", "Marsaxlokk", "Mdina", "Mġarr", "Mosta", "Mqabba", "Msida", "Mtarfa", "Naxxar", "Raħal Gdid", "Pembroke", "Pietà", "Qormi", "Qrendi", "Rabat", "Safi", "San Ġwann", "Santa Luċija", "Santa Venera", "Isla", "Siġġiewi", "Sliema", "San Ġiljan", "San Pawl", "Swieqi", "Tarxien", "Xbiex", "Valletta", "Xgħajra", "Żabbar", "Żebbug", "Żejtun", "Żurrieq", "Fontana", "Għajnsielem", "Għarb", "Għasri", "Kerċem", "Munxar", "Xlendi", "Nadur", "Qala", "Rabat", "San Lawrenz", "Sannat", "Xagħra", "Xewkija", "Marsalforn", "St Paul’s Bay","St Paul's Bay", "Paceville", "Marsascala", "Gozo", "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo, Democratic Republic of the", "Congo, Republic of the", "Costa Rica", "Cote d'Ivoire", "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "East Timor (Timor-Leste)", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kosovo", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar (Burma)", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia (Macedonia)", "Norway", "Oman", "Pakistan", "Palau", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City", "Venezuela", "Vietnam", "Yemen", "Paola", "Europe", "Pozzallo", "UK", "Mellieha", "Senglea", "Cospicua", "St Julian's", "Birzebbuga", "Għajn Żnuber", "Barcelona", "Zabbar", "St Julian’s"]
    for location in locations:
        if re.search(r'\b' + re.escape(location) + r'\b', text, re.IGNORECASE):
            entities["Location"].append(location)

    return entities

# Function to process articles and extract entities related to crimes, locations, dates and names
def process_articles(csv_file, output_file):
    with open(csv_file, "r", encoding="utf-8") as file, open(output_file, "w", encoding="utf-8") as output:
        reader = csv.DictReader(file)
        for row in reader:
            title = row["Title"]
            body = row["Body"]
            entities = extract_entities(title + " " + body)
            output.write("Title: {}\n".format(title))
            output.write("Body: {}\n".format(body))
            output.write("Entities: {}\n".format(entities))
            output.write("\n")

# Example usage
csv_file = "crimedata.csv"
output_file = "output.txt"
process_articles(csv_file, output_file)
